% !TeX encoding = ISO-8859-2

\chapter{Borda címkézés}

A bordák címkézését megvalósító algoritmushoz J. Lee és társai \cite{SegmOfRibs} publikációjában megfogalmazottakat vettem alapul.
Ez alapján az algoritmusom fõbb lépései a~\ref{fig:alg1}ábrán láthatjuk.
Az alábbi alfejezetben ezeket taglalom részletesen.
   
\begin{figure}[h]

\includegraphics{borda_fo_algoritmus.pdf}
\centering
\caption{Algoritmus lépései} \label{fig:alg1}
\end{figure}


\section{Csont szegmentálása}
Egy CT felvételen a levegõtõl a vízen át a csontokon keresztül a kemény implantátumokkal befejezõleg rengeteg különbözõ intenzitás fellelhetõ.
A feladat szempontjából nekünk a csontot reprezentáló intenzitásokra van szükségünk.
Meg kell határoznunk, hogy különbözõ képeken hol található a határ a lágy szövetek és a csont között.
Ennek a megoldását részletezem a következõkben.

\subsection{Otsu szegmentálás}
Otsu szegmentálási módszere, olyan automatikus megoldást nyújt, mely segítségével elég csak a kép hisztogramát felhasználnunk a küszöbérték meghatározására.
Az algoritmus lényegében azt a \textit{t} küszöbértéket keresi, amely minimalizálja az objektum és a háttér közötti varianciát.\cite{otsu}


\begin{figure}[htp]
	
	\includegraphics{otsu_hist.png}
	\centering
	\caption{Histogram és otsuval meghatározott threshold érték} \label{fig:otsu_hist}
\end{figure}
A módszer az alábbi képlet minimalizálásával találja meg az optimális \textit{t} küszöb értéket.
\begin{figure}[htp]
	\begin{equation}
	\sigma_w^2 = \omega_0(t)\sigma_0^2 + \omega_1(t)\sigma_1^2
	\end{equation}
	\centering
	\caption{Variancia képlet} \label{fig:var}
\end{figure}


\subsection{Csont szegmentálása CT képeken}
Otsu módszere több küszöbérték keresésére is alkalmas, CT képek esetén például egyszerû megoldást nyújt a háttér, a levegõ, a lágy szövet, és a csont elválasztására.
\todoi{Folytatni}

\section{Gerinc kijelölés}
A gerinc helyzetének meghatározása kulcsfontosságú a bordadetektálás szempontjából.
Tudjuk, hogy a bordák, a gerinchez kapcsolódnak, ezért, ha ismerjük a gerinc helyzetét, könnyen megtalálhatjuk a csigolyákhoz tartozó bordákat is, a gerinc mentét pásztázva.

\subsection{Hough transzformáció}
\todoi{Megírni a Houg-ot}

\subsection{Körök keresése axiális szeleteken}
A gerinc kijelölésének algoritmusa egy egyszerû észrevételen alapszik, miszerint a gerinc az axiális vetületekbõl
nézve kör alakú.
A szegmentált kép axiális szeletein keressünk kör, illetve kör alakú objektumot a Hough transzformáció segítségével.
A talált körök nagy valószínûséggel a gerincre fognak esni, mivel az axiális vetületeken kevés más hasonló méretû kör alakú objektum látható.
\subsection{Körök helyzetének korrigálása}
Elõfordulhat azonban, hogy a keresést zaj, kevés csont vagy más körlakú objektumok (például aorta) jelenléte nehezíti meg.
A Hough transzformáció segítségével több kör detektálására is képesek vagyunk egy képen.
Ezeket a köröket sorba rendezhetjük aszerint, hogy mennyire valószínû, hogy valóban körrõl van szó.
Szeletenként az elsõ helyen álló kör a legvalószínûbb, hogy csigolyára esik ezt vehetjük alapul.
Számoljunk ezekbõl átlag pozíciót.
Majd keressünk olyan köröket, melyek nagyban eltérnek az átlagtól.
Mivel az elején feltettük hogy az elsõnek választott körök többnyire jó helyen vannak ezért az kicsi a valószínûsége, hogy egy jó helyen lévõ kör fog nagyban eltérni az átlagtól.

Ha az átlagtól nagyban eltérõ kört találunk, haladjunk végig a Hough transzformáció által nyújtott körök listáján és helyettesítsük a kiugró kört egy olyan körrel, ami legközelebb van az átlaghoz a listában.
Ezt a megoldást nevezhetjük elsõ korrekciós lépésnek.
\begin{comment}
\begin{figure}[h]
	\includegraphics{korrig_1_60}
	\centering
	\caption{Körök elsõ korrigálása} \label{fig:korrig_1_1}
\end{figure}
\end{comment}

\subsection{Körök helyzetének második korrigálása}
Elõfordulhat olyan eset is, hogy az adott szeleten egyáltalán nem látszik kör, például a ritka csontozat miatt.
Ebben az esetben a Hough transzformáció aligha fog megfelelõ pozíciójú kört találni.
Ennek a problémának a megoldására szolgál az úgynevezett második korrekciós lépés, mely szerint lokálisan, a körnek meghatározott számú szomszédjából számolunk átlag/medián pozíciót.
A rossz helyen lévõ kört ezzel kiszámolt értékkel helyettesítjük.
A módszer átlagoló/medián szûrõhöz hasonló elven mûködik.
\begin{comment}
\begin{figure}[h]
	\includegraphics{korrig_2_60}
	\centering
	\caption{Körök második korrigálása} \label{fig:korrig_2_1}
\end{figure}
\end{comment}
\begin{figure}[h]
	\includegraphics{gerinc_kinyeres.pdf}
	\centering
	\caption{Gerinckijelölés lépései} \label{fig:gerinc_ki}
\end{figure}

\begin{figure}[!tbp]
	\centering
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_0_60}
		\caption{Korrigálatlan}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_1_60}
		\caption{Elsõ korrigálás}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_2_60}
		\caption{Második korrig}
	\end{minipage}
\end{figure}

%------------------------------------------------------------

\begin{figure}[h]
	\includegraphics{gerinc_kinyeres.pdf}
	\centering
	\caption{Gerinckijelölés lépései} \label{fig:gerinc_ki}
\end{figure}

\begin{figure}[!tbp]
	\centering
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_0_59}
		\caption{Korrigálatlan}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_1_59}
		\caption{Elsõ korrigálás}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_2_59}
		\caption{Második korrig}
	\end{minipage}
\end{figure}

%------------------------------------------------------------

\begin{figure}[h]
	\includegraphics{gerinc_kinyeres.pdf}
	\centering
	\caption{Gerinckijelölés lépései} \label{fig:gerinc_ki}
\end{figure}

\begin{figure}[!tbp]
	\centering
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_0_58}
		\caption{Korrigálatlan}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_1_58}
		\caption{Elsõ korrigálás}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_2_58}
		\caption{Második korrig}
	\end{minipage}
\end{figure}

%------------------------------------------------------------

\begin{figure}[h]
	\includegraphics{gerinc_kinyeres.pdf}
	\centering
	\caption{Gerinckijelölés lépései} \label{fig:gerinc_ki}
\end{figure}

\begin{figure}[!tbp]
	\centering
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_0_57}
		\caption{Korrigálatlan}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_1_57}
		\caption{Elsõ korrigálás}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_2_57}
		\caption{Második korrig}
	\end{minipage}
\end{figure}

%------------------------------------------------------------

\begin{figure}[h]
	\includegraphics{gerinc_kinyeres.pdf}
	\centering
	\caption{Gerinckijelölés lépései} \label{fig:gerinc_ki}
\end{figure}

\begin{figure}[!tbp]
	\centering
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_0_56}
		\caption{Korrigálatlan}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_1_56}
		\caption{Elsõ korrigálás}
	\end{minipage}
	\hfill
	\begin{minipage}[b]{0.3\textwidth}
		\includegraphics[width=\textwidth]{korrig_2_56}
		\caption{Második korrig}
	\end{minipage}
\end{figure}

%------------------------------------------------------------



\section{Magpontok meghatározása}
A gerinc kijelölése kritikus fontosságú az algoritmus szempontjából, hiszen a következõ lépések erre építkeznek.
A bordákat régiónöveléssel tudjuk kijelölni a szegmentált képen.
A régiónöveléshez magpontokra van szükségünk.
Tudjuk, hogy a borda hozzákapcsolódik a gerinchez, ezért célszerû a gerinc mentén egy bizonyos méretõ sávban keresni a magpontokat.
Ha a keresés során csontba ütközünk, akkor indítsunk régiónövelést, és mentsük el a magpont koordinátáit, a késõbbi címkézés meghatározásához.

\section{Nem bordaalakú bojektumok eltávolítása}
\todoi{kitalálni, hogy hogy is mûködik}

\section{Bordák címkézés }
\todoi{Címkézést is le kéne írni}